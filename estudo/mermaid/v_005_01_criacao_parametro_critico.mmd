sequenceDiagram
    participant User as ğŸ‘¤ UsuÃ¡rio Solicitante
    participant WF as ğŸ”„ Workflow Engine
    participant Auth as ğŸ” Auth Service
    participant Config as âš™ï¸ Config Management
    participant Approval as âœ… Approval Service
    participant Audit as ğŸ“ Audit Service
    participant Event as ğŸ“Š Event Store
    participant Notify as ğŸ“§ Notification Service
    participant BCB as ğŸ›ï¸ BCB Compliance

    Note over User, BCB: Fluxo de CriaÃ§Ã£o de ParÃ¢metro CrÃ­tico<br/>Conformidade ResoluÃ§Ã£o CMN 4.893/2021

    User->>+Auth: Login e autenticaÃ§Ã£o RBAC
    Auth-->>User: Token JWT validado
    
    User->>+WF: Solicitar criaÃ§Ã£o parÃ¢metro crÃ­tico
    WF->>+Config: Validar existÃªncia e tipo
    Config-->>WF: ValidaÃ§Ã£o OK
    
    WF->>+Approval: Iniciar workflow aprovaÃ§Ã£o
    Note right of Approval: Art. 3Âº, III - Controles especÃ­ficos<br/>para informaÃ§Ãµes sensÃ­veis
    
    Approval->>+Audit: Registrar inÃ­cio processo
    Audit->>+Event: Store evento "ParameterCreationStarted"
    Event-->>Audit: Evento persistido
    Audit-->>Approval: Registro confirmado
    
    Approval->>+Notify: Notificar aprovadores (L1)
    Notify-->>Approval: NotificaÃ§Ã£o enviada
    
    Note over Approval: Aguarda aprovaÃ§Ã£o NÃ­vel 1<br/>(SegregaÃ§Ã£o de funÃ§Ãµes - SOX)
    
    Approval->>+Audit: Registrar aprovaÃ§Ã£o L1
    Audit->>+Event: Store evento "Level1Approved"
    Event-->>Audit: Evento auditÃ¡vel salvo
    
    Approval->>+Notify: Notificar aprovadores (L2)
    Notify-->>Approval: NotificaÃ§Ã£o L2 enviada
    
    Note over Approval: AprovaÃ§Ã£o NÃ­vel 2<br/>(ParÃ¢metros crÃ­ticos)
    
    Approval->>+Config: Aplicar configuraÃ§Ã£o
    Config->>+Event: Store evento "ParameterApplied"
    
    Config->>+BCB: Comunicar alteraÃ§Ã£o crÃ­tica
    Note right of BCB: Art. 15 - ComunicaÃ§Ã£o obrigatÃ³ria<br/>para alteraÃ§Ãµes relevantes
    BCB-->>Config: Protocolo recebido
    
    Config->>+Audit: Registrar aplicaÃ§Ã£o final
    Audit->>+Event: Store evento "ParameterActive"
    Event-->>Audit: Rastreabilidade completa
    
    Audit->>+Notify: Notificar conclusÃ£o
    Notify-->>User: âœ… ParÃ¢metro ativo
    
    Note over User, BCB: âœ… Conformidade CMN 4.893/2021:<br/>â€¢ Rastreabilidade (Art. 3Âº, III)<br/>â€¢ SegregaÃ§Ã£o de funÃ§Ãµes<br/>â€¢ Auditoria completa<br/>â€¢ ComunicaÃ§Ã£o BCB
